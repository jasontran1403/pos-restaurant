function notify_telegram_new_order($order_id) {
    if (!$order_id) return;

    $already_sent = get_post_meta($order_id, '_telegram_notified', true);
    if ($already_sent) {
        return;
    }

    date_default_timezone_set('Asia/Ho_Chi_Minh');

    $order = wc_get_order($order_id);
    $order_date = wp_date('d/m/Y H:i', strtotime($order->get_date_created()), new DateTimeZone('Asia/Ho_Chi_Minh'));
    $formatted_total = number_format($order->get_total(), 0, ',', '.') . " " . get_woocommerce_currency();

    $billing_first_name = $order->get_billing_first_name();
    $billing_last_name = $order->get_billing_last_name();
    $billing_phone = $order->get_billing_phone();
    $billing_email = $order->get_billing_email();
	
    $shipping = $order->get_address('shipping');

	$address_1 = isset($shipping['address_1']) ? $shipping['address_1'] : 'KhÃ´ng cÃ³';
    $address_2 = isset($shipping['address_2']) ? $shipping['address_2'] : 'KhÃ´ng cÃ³';
    $city = isset($shipping['city']) ? $shipping['city'] : 'KhÃ´ng cÃ³';
    $state = isset($shipping['state']) ? $shipping['state'] : 'KhÃ´ng cÃ³';
	

    $message = "CÃ³ Ä‘Æ¡n Ä‘áº·t hÃ ng má»›i tá»« GreenFingerVietnam\n";
    $message .= "ğŸ“Œ  MÃ£ Ä‘Æ¡n hÃ ng: #{$order->get_id()}\n";
    $message .= "ğŸ™â€â™‚ï¸  KhÃ¡ch hÃ ng: {$billing_first_name} {$billing_last_name}\n";
    $message .= "âœ‰ï¸  Email: {$billing_email}\n";
    $message .= "ğŸ“  Sá»‘ Ä‘iá»‡n thoáº¡i: {$billing_phone}\n";
    $message .= "ğŸ¡  Äá»‹a chá»‰:\n";
    $message .= "  - Sá»‘ nhÃ /TÃªn Ä‘Æ°á»ng: {$address_1}\n";
    $message .= "  - PhÆ°á»ng/ XÃ£: {$address_2}\n";
    $message .= "  - Quáº­n/Huyá»‡n: {$city}\n";
    $message .= "  - Tá»‰nh/ThÃ nh Phá»‘: {$state}\n";

    $message .= "ğŸ›  Sáº£n pháº©m: \n";
    foreach ($order->get_items() as $item) {
        $product_name = $item->get_name();
        $quantity = $item->get_quantity();
        $message .= "{$product_name} - Sá»‘ lÆ°á»£ng: {$quantity}\n";
    }

    $message .= "ğŸ§  PhÆ°Æ¡ng thá»©c thanh toÃ¡n: " . $order->get_payment_method_title() . "\n";
    $message .= "ğŸ’°  Tá»•ng tiá»n: {$formatted_total}";

    send_telegram_message($message);

    update_post_meta($order_id, '_telegram_notified', true);
}
